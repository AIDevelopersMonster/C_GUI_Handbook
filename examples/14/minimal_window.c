#include <gtk/gtk.h> // Подключаем основную библиотеку GTK. Этого заголовочного файла достаточно для большинства базовых функций.

/**
 * @brief Callback-функция, которая будет вызвана при нажатии кнопки.
 *
 * Эта функция закрывает окно приложения. Она подключается к сигналу "clicked"
 * кнопки и получает указатель на окно в качестве пользовательских данных.
 *
 * @param widget Указатель на GtkWidget, который испустил сигнал (в данном случае, кнопка).
 * @param data   Указатель на пользовательские данные, переданные при подключении сигнала.
 * В нашем примере это будет указатель на GtkWindow, которое нужно закрыть.
 */
static void on_button_clicked(GtkWidget *widget, gpointer data) {
    // Закрываем окно, переданное в качестве 'data'.
    // GTK_WINDOW(data) - это макрос приведения типа (type casting), который безопасно
    // преобразует универсальный указатель gpointer к более специфичному типу GtkWindow*.
    // Это необходимо, так как функция gtk_window_close() ожидает аргумент типа GtkWindow*.
    gtk_window_close(GTK_WINDOW(data));
}

/**
 * @brief Главная функция программы.
 *
 * Здесь происходит инициализация GTK, создание окна, кнопки,
 * подключение сигналов и запуск основного цикла событий GTK.
 *
 * @param argc Количество аргументов командной строки.
 * @param argv Массив строк аргументов командной строки.
 * @return Код завершения программы (0 при успешном выполнении).
 */
int main(int argc, char *argv[]) {
    // Инициализируем библиотеку GTK.
    // Это обязательный вызов для любой GTK-программы. Он обрабатывает аргументы
    // командной строки, специфичные для GTK, и подготавливает внутренние структуры
    // библиотеки для работы. Должен быть вызван до создания любых виджетов GTK.
    gtk_init(&argc, &argv);

    // Создаём новое окно верхнего уровня.
    // GtkWidget* - это базовый тип для всех видимых элементов (виджетов) в GTK.
    // GTK_WINDOW_TOPLEVEL указывает, что это будет независимое, главное окно приложения.
    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);

    // Устанавливаем заголовок окна. Этот текст будет отображаться в строке заголовка окна.
    // GTK_WINDOW(window) выполняет приведение типа, поскольку gtk_window_set_title()
    // ожидает аргумент типа GtkWindow*.
    gtk_window_set_title(GTK_WINDOW(window), "GTK Minimal App");

    // Устанавливаем размер окна по умолчанию (ширина, высота) в пикселях.
    // Эти размеры могут быть изменены пользователем.
    gtk_window_set_default_size(GTK_WINDOW(window), 300, 100);

    // Устанавливаем начальное положение окна на экране.
    // GTK_WIN_POS_CENTER центрирует окно на экране при его первом появлении.
    gtk_window_set_position(GTK_WINDOW(window), GTK_WIN_POS_CENTER);

    // Подключаем сигнал "destroy" окна к функции gtk_main_quit.
    // Сигнал "destroy" испускается, когда пользователь пытается закрыть окно
    // (например, кликая на кнопку "X" в заголовке окна или используя Alt+F4).
    // gtk_main_quit() - это встроенная функция GTK, которая останавливает
    // главный цикл событий GTK, позволяя программе корректно завершиться.
    // Если этого не сделать, закрытие окна не остановит программу, и она будет висеть в памяти.
    g_signal_connect(window, "destroy", G_CALLBACK(gtk_main_quit), NULL);

    // Создаём новую кнопку с текстовой меткой "Закрыть".
    GtkWidget *button = gtk_button_new_with_label("Закрыть");

    // Подключаем сигнал "clicked" от нашей кнопки к функции on_button_clicked.
    // Когда пользователь нажимает на эту кнопку, GTK вызовет функцию on_button_clicked.
    // В качестве четвёртого аргумента (user_data) мы передаём указатель на 'window'.
    // Это позволяет функции on_button_clicked получить доступ к окну, которое нужно закрыть.
    g_signal_connect(button, "clicked", G_CALLBACK(on_button_clicked), window);

    // Добавляем созданную кнопку в окно.
    // В GTK3 окна обычно могут содержать только один прямой дочерний виджет.
    // gtk_container_add() - это функция для добавления виджетов в контейнеры.
    // GTK_CONTAINER(window) - это приведение типа, позволяющее работать с окном как с контейнером.
    gtk_container_add(GTK_CONTAINER(window), button);

    // Показываем все виджеты, начиная с окна и включая все его дочерние элементы.
    // Виджеты по умолчанию создаются невидимыми; их нужно явно показать, чтобы они появились на экране.
    gtk_widget_show_all(window); // Эта функция покажет и окно, и кнопку внутри него.

    // Запускаем главный цикл обработки событий GTK.
    // Эта функция передает управление библиотеке GTK, которая начинает слушать
    // и обрабатывать все события (клики мыши, нажатия клавиш, системные сообщения и т.д.).
    // Программа будет выполняться в этом цикле до тех пор, пока не будет вызвана
    // gtk_main_quit() (например, при закрытии окна или нажатии нашей кнопки).
    gtk_main();

    // Возвращаем 0, указывая операционной системе на успешное завершение программы.
    return 0;
}