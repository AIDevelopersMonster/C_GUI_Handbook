-----

# Глава 16: Метки и Базовые Контейнеры Компоновки (GtkBox)

В этой главе мы углубимся в создание более сложных графических интерфейсов, изучив два ключевых элемента: **текстовые метки** с помощью `GtkLabel` и **контейнеры для компоновки виджетов** (`GtkBox`). Вы научитесь отображать статический текст и эффективно располагать несколько элементов интерфейса по вертикали или горизонтали.

### Что вы узнаете в этой главе:

  * **Как создать базовую кнопку** с текстовой меткой.
  * **Что такое "сигналы" в GTK** и как они являются основой обработки событий.
  * **Как "подключить" (connect) ваш код** к сигналам, испускаемым виджетами.
  * **Как написать функцию-обработчик** (callback) для реакции на клик по кнопке.
  * **Как использовать `g_print()`** для вывода отладочной информации.

-----

## GtkLabel: Отображение Текста

`GtkLabel` — это фундаментальный виджет GTK, предназначенный для отображения одной или нескольких строк текста. Его широко используют для:

  * **Подписей** к другим элементам управления (например, "Имя пользователя:").
  * **Заголовков** разделов или окон.
  * **Пояснений** и инструкций для пользователя.
  * **Отображения динамически изменяющегося текста** (например, счётчика, статуса).

Текст в `GtkLabel` может быть простым или форматированным с использованием **Pango Markup**, что позволяет применять жирный шрифт, курсив, изменять цвет и размер текста.

### Пример 16.1: Простое окно с меткой

Название исходного файла: `label_example.c`

Этот пример демонстрирует базовое использование `GtkLabel` для отображения простого приветствия в центре окна.

```c
#include <gtk/gtk.h> // Подключаем основную библиотеку GTK.
                       // Этот заголовочный файл содержит все необходимые определения
                       // для создания графических интерфейсов с помощью GTK.

/**
 * @brief Главная функция программы, точка входа.
 *
 * Эта функция отвечает за инициализацию GTK, создание основного окна,
 * добавление метки и запуск главного цикла обработки событий.
 *
 * @param argc Количество аргументов командной строки, переданных программе.
 * @param argv Массив строк аргументов командной строки. GTK может использовать
 * эти аргументы для своих внутренних настроек (например, `--display`).
 * @return Код завершения программы (0 при успешном выполнении, отличное от 0 в случае ошибки).
 */
int main(int argc, char *argv[]) {
    // Инициализация GTK.
    // Это первый и обязательный вызов в любой GTK-программе.
    // Он подготавливает библиотеку к работе, обрабатывает специфические
    // для GTK аргументы командной строки и устанавливает базовые параметры.
    gtk_init(&argc, &argv);

    // Создание главного окна приложения.
    // GtkWidget* - это универсальный указатель на любой виджет в GTK.
    // gtk_window_new(GTK_WINDOW_TOPLEVEL) создает новое окно верхнего уровня,
    // которое является независимым окном на рабочем столе.
    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);

    // Установка заголовка окна.
    // GTK_WINDOW(window) - это макрос, который "приводит" (casts) универсальный
    // GtkWidget* к более специфичному типу GtkWindow*, необходимому для функций
    // работы с окнами.
    gtk_window_set_title(GTK_WINDOW(window), "Пример с GtkLabel");

    // Установка размера окна по умолчанию (ширина, высота в пикселях).
    // Пользователь сможет изменить этот размер вручную.
    gtk_window_set_default_size(GTK_WINDOW(window), 300, 100);

    // Установка начального положения окна на экране.
    // GTK_WIN_POS_CENTER центрирует окно по центру экрана при его первом появлении.
    gtk_window_set_position(GTK_WINDOW(window), GTK_WIN_POS_CENTER);

    // Подключение сигнала "destroy" к функции gtk_main_quit.
    // Сигнал "destroy" испускается, когда пользователь пытается закрыть окно
    // (например, кликая на кнопку "X" в заголовке или используя Alt+F4).
    // gtk_main_quit() останавливает главный цикл событий GTK, что приводит к
    // корректному завершению работы программы. Это критически важно для
    // предотвращения "зависания" приложения после закрытия окна.
    g_signal_connect(window, "destroy", G_CALLBACK(gtk_main_quit), NULL);

    // Создание метки (текстового виджета) с заданным текстом.
    // GtkLabel - это виджет, который отображает статический текст.
    // Важно: если вы используете символы не из ASCII (например, русские буквы),
    // убедитесь, что ваш исходный файл (.c) сохранен в кодировке UTF-8.
    // Иначе могут возникнуть предупреждения Pango или неправильное отображение текста.
    GtkWidget *label = gtk_label_new("Привет, GTK!");

    // Добавление метки в окно.
    // GtkWindow является контейнером для одного дочернего виджета.
    // gtk_container_add() добавляет 'label' в 'window'.
    // GTK_CONTAINER(window) - еще одно приведение типа для работы с окном как с контейнером.
    // Поскольку окно содержит только одну метку, GTK автоматически центрирует её.
    gtk_container_add(GTK_CONTAINER(window), label);

    // Отображение всех виджетов в окне.
    // По умолчанию виджеты создаются невидимыми. gtk_widget_show_all() делает
    // видимым само окно и все виджеты, которые в него добавлены.
    gtk_widget_show_all(window);

    // Запуск главного цикла обработки событий GTK.
    // Эта функция передает управление библиотеке GTK. Программа переходит в
    // режим ожидания событий (кликов мышью, нажатий клавиш, системных сообщений).
    // Этот цикл продолжается до тех пор, пока не будет вызвана функция gtk_main_quit().
    gtk_main();

    // Возвращаем 0, что является стандартным кодом успешного завершения программы.
    return 0;
}
```

**Комментарии к коду:**

  * `gtk_label_new("Привет, GTK!");`: Эта функция создаёт новый виджет `GtkLabel` с указанным текстом. Важно, чтобы исходный файл был сохранен в кодировке **UTF-8**, если вы используете нелатинские символы (например, русские буквы), иначе могут возникнуть предупреждения Pango или некорректное отображение.
  * `gtk_container_add(GTK_CONTAINER(window), label);`: В данном случае, поскольку `GtkWindow` является контейнером для одного виджета, добавленная метка будет автоматически центрирована в окне.

-----

## GtkBox: Горизонтальная и Вертикальная Компоновка

`GtkBox` — это один из наиболее часто используемых **контейнеров компоновки** в GTK. Он позволяет размещать несколько виджетов в одном ряду — либо **по горизонтали** (`GTK_ORIENTATION_HORIZONTAL`), либо **по вертикали** (`GTK_ORIENTATION_VERTICAL`).

`GtkBox` упрощает создание линейных интерфейсов, будь то строка кнопок или столбец полей ввода.

### Основные функции GtkBox:

  * `gtk_box_new(GtkOrientation orientation, int spacing)`: Создаёт новый контейнер `GtkBox`.

      * `orientation`: Определяет направление размещения виджетов. Может быть `GTK_ORIENTATION_HORIZONTAL` или `GTK_ORIENTATION_VERTICAL`.
      * `spacing`: Определяет фиксированный **отступ** (в пикселях) между соседними виджетами внутри бокса.

  * `gtk_box_pack_start(GtkBox *box, GtkWidget *child, gboolean expand, gboolean fill, guint padding)`: Добавляет дочерний виджет в **начало** (или верх/лево) бокса.

      * `box`: Указатель на контейнер `GtkBox`.
      * `child`: Виджет, который нужно добавить.
      * `expand`: Если `TRUE`, виджет будет занимать максимально доступное пространство в том направлении, в котором он "растёт" (для вертикального бокса — по вертикали, для горизонтального — по горизонтали), если оно доступно. Если `FALSE`, он займёт только минимально необходимое пространство.
      * `fill`: Если `TRUE`, виджет будет заполнять всё доступное пространство в своём сегменте бокса. Если `FALSE`, он будет использовать только свой естественный размер, а остальное пространство будет пустым.
      * `padding`: Дополнительный отступ (в пикселях), который будет добавлен вокруг этого конкретного виджета внутри бокса. Этот отступ добавляется к `spacing` всего бокса.

  * `gtk_box_pack_end(GtkBox *box, GtkWidget *child, gboolean expand, gboolean fill, guint padding)`: Аналогично `gtk_box_pack_start`, но добавляет виджет в **конец** (или низ/право) бокса.

### Пример 16.2: Окно с вертикальным GtkBox

Название исходного файла: `layout_vbox_example.c`

Этот пример демонстрирует создание вертикального `GtkBox`, который содержит метку и кнопку, расположенные друг под другом.

```c
#include <gtk/gtk.h> // Подключаем основную библиотеку GTK.

/**
 * @brief Callback-функция, которая будет вызвана при нажатии кнопки.
 *
 * Эта функция демонстрирует, что кнопка внутри GtkBox была успешно нажата,
 * выводя сообщение в консоль.
 *
 * @param widget Указатель на GtkWidget, который испустил сигнал (в данном случае, GtkButton).
 * Мы не используем этот параметр явно в данной функции, но он всегда передаётся.
 * @param data   Универсальный указатель на пользовательские данные. В этом примере NULL,
 * так как никаких дополнительных данных для этой простой функции не требуется.
 */
static void on_button_clicked(GtkWidget *widget, gpointer data) {
    // g_print() - это удобная функция из библиотеки GLib (основы GTK),
    // похожая на printf(), но разработанная для корректного вывода в консоль
    // из GUI-приложений GTK, особенно когда они запускаются без прямого терминала
    // (например, из IDE или менеджера файлов).
    g_print("Кнопка в GtkBox нажата!\n");
}

/**
 * @brief Главная функция программы.
 *
 * Инициализирует GTK, создаёт окно, вертикальный контейнер GtkBox,
 * добавляет в него метку и кнопку, подключает обработчики событий
 * и запускает главный цикл GTK.
 *
 * @param argc Количество аргументов командной строки.
 * @param argv Массив строк аргументов командной строки.
 * @return Код завершения программы.
 */
int main(int argc, char *argv[]) {
    // 1. Инициализация GTK.
    // Обязательный первый шаг для любой GTK-программы.
    gtk_init(&argc, &argv);

    // 2. Создание главного окна.
    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);
    gtk_window_set_title(GTK_WINDOW(window), "GtkBox Вертикальный Пример");
    gtk_window_set_default_size(GTK_WINDOW(window), 300, 150);
    gtk_window_set_position(GTK_WINDOW(window), GTK_WIN_POS_CENTER);

    // Подключение сигнала "destroy" окна для его закрытия.
    g_signal_connect(window, "destroy", G_CALLBACK(gtk_main_quit), NULL);

    // 3. Создание вертикального контейнера GtkBox.
    // GtkBox - это контейнер, который располагает свои дочерние виджеты
    // либо по вертикали, либо по горизонтали.
    // GTK_ORIENTATION_VERTICAL - указывает, что виджеты будут располагаться
    //                            друг под другом (сверху вниз).
    // 10 - это 'spacing', фиксированный отступ в 10 пикселей между каждым
    //      дочерним виджетом внутри этого GtkBox.
    GtkWidget *vbox = gtk_box_new(GTK_ORIENTATION_VERTICAL, 10);

    // 4. Создание дочерних виджетов для GtkBox.
    GtkWidget *label = gtk_label_new("Это метка внутри VBox");
    GtkWidget *button = gtk_button_new_with_label("Нажми меня!");

    // 5. Подключение обработчика к кнопке.
    // Когда пользователь кликнет по кнопке, вызовется наша функция on_button_clicked.
    g_signal_connect(button, "clicked", G_CALLBACK(on_button_clicked), NULL);

    // 6. Добавление виджетов в GtkBox с использованием gtk_box_pack_start().
    // Эта функция добавляет виджет в начало (верх) GtkBox.
    // Параметры:
    //   - GTK_BOX(vbox): Приведение типа к GtkBox*.
    //   - label: Добавляемый виджет.
    //   - TRUE (expand): Разрешает метке расширяться, занимая доступное пространство
    //                    в вертикальном направлении, если оно есть.
    //   - TRUE (fill): Заставляет метку заполнять все выделенное ей пространство.
    //   - 5 (padding): Дополнительный отступ в 5 пикселей вокруг виджета 'label'.
    gtk_box_pack_start(GTK_BOX(vbox), label, TRUE, TRUE, 5);
    gtk_box_pack_start(GTK_BOX(vbox), button, TRUE, TRUE, 5); // Аналогично для кнопки

    // 7. Добавление GtkBox в окно.
    // Теперь окно содержит не отдельные метку и кнопку, а контейнер vbox,
    // который уже упорядочивает эти элементы.
    gtk_container_add(GTK_CONTAINER(window), vbox);

    // 8. Отображение всех виджетов (окна, GtkBox, метки, кнопки).
    gtk_widget_show_all(window);

    // 9. Запуск главного цикла событий GTK.
    gtk_main();

    return 0; // Успешное завершение программы.
}
```

### Пример 16.3: Окно с горизонтальным GtkBox

Название исходного файла: `layout_hbox_example.c`

Этот пример демонстрирует создание горизонтального `GtkBox`, который содержит три кнопки, расположенные рядом.

```c
#include <gtk/gtk.h> // Подключаем основную библиотеку GTK.

/**
 * @brief Единая callback-функция для обработки нажатий на несколько кнопок.
 *
 * Эта функция демонстрирует, как получить текст нажатой кнопки и вывести его
 * в консоль, что полезно для отладки или для выполнения разных действий
 * в зависимости от того, какая кнопка была нажата.
 *
 * @param widget Указатель на GtkWidget, который испустил сигнал (GtkButton).
 * @param data   Универсальный указатель на пользовательские данные (в данном случае NULL).
 */
static void on_generic_button_clicked(GtkWidget *widget, gpointer data) {
    // gtk_button_get_label() - функция для получения текста (метки) с кнопки.
    // GTK_BUTTON(widget) - приведение типа GtkWidget* к GtkButton*.
    const char *button_label = gtk_button_get_label(GTK_BUTTON(widget));
    g_print("Нажата кнопка: %s\n", button_label);
}

/**
 * @brief Главная функция программы.
 *
 * Инициализирует GTK, создает окно, горизонтальный контейнер GtkBox,
 * добавляет в него несколько кнопок с различными параметрами компоновки,
 * подключает обработчики событий и запускает главный цикл GTK.
 *
 * @param argc Количество аргументов командной строки.
 * @param argv Массив строк аргументов командной строки.
 * @return Код завершения программы.
 */
int main(int argc, char *argv[]) {
    // 1. Инициализация GTK.
    gtk_init(&argc, &argv);

    // 2. Создание главного окна.
    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);
    gtk_window_set_title(GTK_WINDOW(window), "GtkBox Горизонтальный Пример");
    gtk_window_set_default_size(GTK_WINDOW(window), 450, 100); // Окно пошире для горизонтального расположения
    gtk_window_set_position(GTK_WINDOW(window), GTK_WIN_POS_CENTER);

    // Подключение сигнала "destroy" окна для его закрытия.
    g_signal_connect(window, "destroy", G_CALLBACK(gtk_main_quit), NULL);

    // 3. Создание горизонтального контейнера GtkBox.
    // GTK_ORIENTATION_HORIZONTAL - виджеты будут располагаться слева направо.
    // 5 - отступ в 5 пикселей между каждым дочерним виджетом.
    GtkWidget *hbox = gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 5);

    // 4. Создание трёх кнопок.
    GtkWidget *button1 = gtk_button_new_with_label("Кнопка 1");
    GtkWidget *button2 = gtk_button_new_with_label("Кнопка 2");
    GtkWidget *button3 = gtk_button_new_with_label("Кнопка 3");

    // 5. Подключение одной и той же функции обработчика к каждой кнопке.
    g_signal_connect(button1, "clicked", G_CALLBACK(on_generic_button_clicked), NULL);
    g_signal_connect(button2, "clicked", G_CALLBACK(on_generic_button_clicked), NULL);
    g_signal_connect(button3, "clicked", G_CALLBACK(on_generic_button_clicked), NULL);

    // 6. Добавление кнопок в GtkBox с разными параметрами pack_start/pack_end.
    // Эти параметры контролируют, как виджеты будут распределять доступное пространство.

    // Кнопка 1: pack_start, не расширяется (FALSE), не заполняет (FALSE), без доп. отступа (0).
    // Она займет только свой минимальный размер и будет прижата к левому краю.
    gtk_box_pack_start(GTK_BOX(hbox), button1, FALSE, FALSE, 0);

    // Кнопка 2: pack_start, расширяется (TRUE), заполняет (TRUE), без доп. отступа (0).
    // Она будет пытаться занять максимально доступное пространство между кнопкой 1 и 3.
    gtk_box_pack_start(GTK_BOX(hbox), button2, TRUE, TRUE, 0);

    // Кнопка 3: pack_end, не расширяется (FALSE), но заполняет (TRUE), без доп. отступа (0).
    // Она будет прижата к правому краю. Параметр 'fill' здесь означает, что если ей выделено
    // немного больше места (из-за общего отступа бокса), она заполнит это место.
    gtk_box_pack_end(GTK_BOX(hbox), button3, FALSE, TRUE, 0);

    // 7. Добавление GtkBox в окно.
    gtk_container_add(GTK_CONTAINER(window), hbox);

    // 8. Отображение всех виджетов.
    gtk_widget_show_all(window);

    // 9. Запуск главного цикла событий GTK.
    gtk_main();

    return 0; // Успешное завершение программы.
}
```

**Комментарии к `gtk_box_pack_start` (и `gtk_box_pack_end`):**

Эти функции являются ключевыми для управления тем, как виджеты будут себя вести внутри `GtkBox`:

  * `expand` (`gboolean`):
      * `TRUE`: Виджет будет пытаться **занять любое дополнительное пространство**, которое остаётся в контейнере `GtkBox` после того, как все виджеты с `expand=FALSE` займут своё минимальное место. Если несколько виджетов имеют `expand=TRUE`, они разделят это дополнительное пространство между собой.
      * `FALSE`: Виджет займёт **только минимально необходимое пространство**. Он не будет расширяться, даже если есть свободное место.
  * `fill` (`gboolean`):
      * `TRUE`: Если виджету выделено больше пространства, чем его естественный размер (например, потому что `expand` был `TRUE` или контейнер просто большой), он **заполнит всё выделенное ему пространство**.
      * `FALSE`: Виджет будет использовать только свой **естественный размер**, даже если ему выделено больше места. Оставшееся пространство внутри его "ячейки" в боксе будет пустым.
  * `padding` (`guint`):
      * Дополнительный отступ (в пикселях), который будет добавлен к естественному пространству, занимаемому виджетом. Этот отступ применяется по обе стороны от виджета в направлении ориентации бокса.

Понимание `expand` и `fill` критически важно для создания гибких и адаптивных макетов, которые хорошо выглядят при разных размерах окон.

-----

## Компиляция и Запуск

Сохраните каждый пример кода в соответствующий файл (например, `label_example.c`, `layout_vbox_example.c`, `layout_hbox_example.c`).

Для сборки используйте следующую команду, адаптируя её для каждого файла:

```bash
# Для примера с GtkLabel:
gcc label_example.c -o label_example `pkg-config --cflags --libs gtk+-3.0`
./label_example

# Для примера с вертикальным GtkBox:
gcc layout_vbox_example.c -o layout_vbox_example `pkg-config --cflags --libs gtk+-3.0`
./layout_vbox_example

# Для примера с горизонтальным GtkBox:
gcc layout_hbox_example.c -o layout_hbox_example `pkg-config --cflags --libs gtk+-3.0`
./layout_hbox_example
```

-----

## Ожидаемый результат

  * **`label_example.c`**: Откроется небольшое окно с заголовком "Пример с GtkLabel" и по центру будет виден текст **"Привет, GTK\!"**.
  * **`layout_vbox_example.c`**: Появится окно с заголовком "GtkBox Вертикальный Пример". Внутри будут расположены **метка** ("Это метка внутри VBox") над **кнопкой** ("Нажми меня\!"). Между ними будет небольшой отступ. При нажатии кнопки, в терминал будет выведено сообщение.
  * **`layout_hbox_example.c`**: Откроется окно "GtkBox Горизонтальный Пример". Внутри будут расположены **три кнопки** ("Кнопка 1", "Кнопка 2", "Кнопка 3") рядом друг с другом. Вы заметите, что "Кнопка 2" занимает больше места, растягиваясь, так как для неё `expand` и `fill` установлены в `TRUE`. При нажатии любой из кнопок, в терминал будет выведено сообщение, указывающее, какая кнопка была нажата.

-----

## Дополнительные ресурсы

  * [Официальная документация GtkLabel](https://docs.gtk.org/gtk3/class.Label.html)
  * [Официальная документация GtkBox](https://docs.gtk.org/gtk3/class.Box.html)
  * [Раздел "Containers" в официальной документации GTK3](https://developer.gnome.org/gtk3/stable/ch03.html)
  * [Репозиторий с примерами кода из этого руководства](https://github.com/AIDevelopersMonster/C_GUI_Handbook)

-----

### Навигация

  * [Глава 15: Кнопки и обработка событий](https://github.com/AIDevelopersMonster/C_GUI_Handbook/tree/main/examples/15)
  * [Глава 17: Ввод текста и поля ввода](https://github.com/AIDevelopersMonster/C_GUI_Handbook/tree/main/examples/17)