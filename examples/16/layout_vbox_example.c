#include <gtk/gtk.h> // Подключаем основную библиотеку GTK.

/**
 * @brief Callback-функция, которая будет вызвана при нажатии кнопки.
 *
 * Эта функция демонстрирует, что кнопка внутри GtkBox была успешно нажата,
 * выводя сообщение в консоль.
 *
 * @param widget Указатель на GtkWidget, который испустил сигнал (в данном случае, GtkButton).
 * Мы не используем этот параметр явно в данной функции, но он всегда передаётся.
 * @param data   Универсальный указатель на пользовательские данные. В этом примере NULL,
 * так как никаких дополнительных данных для этой простой функции не требуется.
 */
static void on_button_clicked(GtkWidget *widget, gpointer data) {
    // g_print() - это удобная функция из библиотеки GLib (основы GTK),
    // похожая на printf(), но разработанная для корректного вывода в консоль
    // из GUI-приложений GTK, особенно когда они запускаются без прямого терминала
    // (например, из IDE или менеджера файлов).
    g_print("Кнопка в GtkBox нажата!\n");
}

/**
 * @brief Главная функция программы.
 *
 * Инициализирует GTK, создаёт окно, вертикальный контейнер GtkBox,
 * добавляет в него метку и кнопку, подключает обработчики событий
 * и запускает главный цикл GTK.
 *
 * @param argc Количество аргументов командной строки.
 * @param argv Массив строк аргументов командной строки.
 * @return Код завершения программы.
 */
int main(int argc, char *argv[]) {
    // 1. Инициализация GTK.
    // Обязательный первый шаг для любой GTK-программы.
    gtk_init(&argc, &argv);

    // 2. Создание главного окна.
    GtkWidget *window = gtk_window_new(GTK_WINDOW_TOPLEVEL);
    gtk_window_set_title(GTK_WINDOW(window), "GtkBox Вертикальный Пример");
    gtk_window_set_default_size(GTK_WINDOW(window), 300, 150);
    gtk_window_set_position(GTK_WINDOW(window), GTK_WIN_POS_CENTER);

    // Подключение сигнала "destroy" окна для его закрытия.
    g_signal_connect(window, "destroy", G_CALLBACK(gtk_main_quit), NULL);

    // 3. Создание вертикального контейнера GtkBox.
    // GtkBox - это контейнер, который располагает свои дочерние виджеты
    // либо по вертикали, либо по горизонтали.
    // GTK_ORIENTATION_VERTICAL - указывает, что виджеты будут располагаться
    //                            друг под другом (сверху вниз).
    // 10 - это 'spacing', фиксированный отступ в 10 пикселей между каждым
    //      дочерним виджетом внутри этого GtkBox.
    GtkWidget *vbox = gtk_box_new(GTK_ORIENTATION_VERTICAL, 10);

    // 4. Создание дочерних виджетов для GtkBox.
    GtkWidget *label = gtk_label_new("Это метка внутри VBox");
    GtkWidget *button = gtk_button_new_with_label("Нажми меня!");

    // 5. Подключение обработчика к кнопке.
    // Когда пользователь кликнет по кнопке, вызовется наша функция on_button_clicked.
    g_signal_connect(button, "clicked", G_CALLBACK(on_button_clicked), NULL);

    // 6. Добавление виджетов в GtkBox с использованием gtk_box_pack_start().
    // Эта функция добавляет виджет в начало (верх) GtkBox.
    // Параметры:
    //   - GTK_BOX(vbox): Приведение типа к GtkBox*.
    //   - label: Добавляемый виджет.
    //   - TRUE (expand): Разрешает метке расширяться, занимая доступное пространство
    //                    в вертикальном направлении, если оно есть.
    //   - TRUE (fill): Заставляет метку заполнять все выделенное ей пространство.
    //   - 5 (padding): Дополнительный отступ в 5 пикселей вокруг виджета 'label'.
    gtk_box_pack_start(GTK_BOX(vbox), label, TRUE, TRUE, 5);
    gtk_box_pack_start(GTK_BOX(vbox), button, TRUE, TRUE, 5); // Аналогично для кнопки

    // 7. Добавление GtkBox в окно.
    // Теперь окно содержит не отдельные метку и кнопку, а контейнер vbox,
    // который уже упорядочивает эти элементы.
    gtk_container_add(GTK_CONTAINER(window), vbox);

    // 8. Отображение всех виджетов (окна, GtkBox, метки, кнопки).
    gtk_widget_show_all(window);

    // 9. Запуск главного цикла событий GTK.
    gtk_main();

    return 0; // Успешное завершение программы.
}