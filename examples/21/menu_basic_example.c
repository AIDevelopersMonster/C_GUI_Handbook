#include <gtk/gtk.h> // Подключаем основную библиотеку GTK.

/**
 * @brief Callback-функция, вызываемая при активации пункта меню "Выход".
 *
 * Эта функция будет выполнена, когда пользователь выберет пункт "Выход" в меню.
 * Она демонстрирует, как подключить действие к GtkMenuItem.
 *
 * @param widget Указатель на виджет, который сгенерировал сигнал (в данном случае GtkMenuItem).
 * Мы не используем его напрямую в этой функции, но он всегда передается.
 * @param data Дополнительные данные, переданные при подключении сигнала.
 * В этом примере NULL, так как никаких дополнительных данных не требуется.
 */
static void on_menu_item_activate(GtkWidget *widget, gpointer data) {
    g_print("Выход из приложения\n"); // Печатаем сообщение в стандартный вывод (консоль).
    gtk_main_quit();                   // Завершаем главный цикл событий GTK.
                                       // Это приводит к закрытию всех GTK-окон и выходу из программы.
}

/**
 * @brief Главная функция программы.
 *
 * Здесь происходит инициализация GTK, создание главного окна,
 * настройка меню и запуск основного цикла событий приложения.
 *
 * @param argc Количество аргументов командной строки.
 * @param argv Массив строк аргументов командной строки.
 * @return Код завершения программы (0 при успешном выполнении).
 */
int main(int argc, char *argv[]) {
    GtkWidget *window;    // Декларация указателя на основное окно приложения.
    GtkWidget *vbox;      // Декларация указателя на вертикальный контейнер GtkBox.
                          // Мы используем GtkBox, чтобы разместить панель меню сверху,
                          // а под ней, возможно, другие виджеты.
    GtkWidget *menubar;   // Декларация указателя на горизонтальную панель меню (GtkMenuBar).
                          // Она содержит главные (корневые) пункты меню, например "Файл".
    GtkWidget *file_menu; // Декларация указателя на выпадающее подменю (GtkMenu).
                          // Это меню будет появляться при клике на "Файл".
    GtkWidget *file_item; // Декларация указателя на пункт меню "Файл" (GtkMenuItem).
                          // Это тот пункт, который отображается в GtkMenuBar.
    GtkWidget *exit_item; // Декларация указателя на пункт меню "Выход" (GtkMenuItem).
                          // Это тот пункт, который находится внутри file_menu.

    gtk_init(&argc, &argv); // **Инициализация библиотеки GTK**.
                            // Эта функция должна быть вызвана первой в любом GTK-приложении.
                            // Она обрабатывает аргументы командной строки, специфичные для GTK.

    // 1. **Создание главного окна приложения.**
    window = gtk_window_new(GTK_WINDOW_TOPLEVEL); // Создает новое окно верхнего уровня.
                                                  // GTK_WINDOW_TOPLEVEL означает, что это самостоятельное окно.
    gtk_window_set_title(GTK_WINDOW(window), "Пример Простейшего Меню"); // Устанавливает заголовок окна,
                                                                          // который отображается в системной строке.
    gtk_window_set_default_size(GTK_WINDOW(window), 300, 200); // Устанавливает начальный размер окна (ширина, высота).
    gtk_window_set_position(GTK_WINDOW(window), GTK_WIN_POS_CENTER); // Центрирует окно на экране при запуске.

    // 2. **Подключение сигнала закрытия окна.**
    // При получении виджетом 'window' сигнала "destroy" (например, когда пользователь
    // нажимает кнопку закрытия окна), будет вызвана функция 'gtk_main_quit'.
    // 'G_CALLBACK' - это макрос для приведения указателя функции к нужному типу.
    // 'NULL' - это 'data' (пользовательские данные), которые будут переданы в callback,
    // в данном случае они не нужны.
    g_signal_connect(window, "destroy", G_CALLBACK(gtk_main_quit), NULL);

    // 3. **Создание и настройка основного контейнера.**
    // Создаем вертикальный GtkBox. Аргументы: ориентация (вертикальная),
    // и промежуток между элементами (0 - без промежутков).
    vbox = gtk_box_new(GTK_ORIENTATION_VERTICAL, 0);
    // Добавляем созданный GtkBox в окно. GtkWindow является GtkContainer.
    gtk_container_add(GTK_CONTAINER(window), vbox);

    // 4. **Создание компонентов меню.**
    menubar = gtk_menu_bar_new(); // Создает пустую горизонтальную панель меню.
    file_menu = gtk_menu_new();   // Создает пустое выпадающее подменю.

    // Создает новый пункт меню с текстовой меткой.
    // `_with_label` означает, что виджет уже содержит GtkLabel.
    file_item = gtk_menu_item_new_with_label("Файл");
    exit_item = gtk_menu_item_new_with_label("Выход");

    // 5. **Сборка иерархии меню.**
    // Добавляем 'exit_item' (пункт "Выход") в 'file_menu' (выпадающее подменю).
    // `GtkMenuShell` - это интерфейс, который реализуют GtkMenu и GtkMenuBar.
    // Он позволяет добавлять в себя GtkMenuItem.
    gtk_menu_shell_append(GTK_MENU_SHELL(file_menu), exit_item);

    // Устанавливаем 'file_menu' как подменю для 'file_item' (пункта "Файл").
    // Это делает "Файл" раскрывающимся пунктом.
    gtk_menu_item_set_submenu(GTK_MENU_ITEM(file_item), file_menu);

    // Добавляем 'file_item' (пункт "Файл" с его подменю) в 'menubar' (панель меню).
    // Таким образом, "Файл" становится корневым элементом в горизонтальной панели.
    gtk_menu_shell_append(GTK_MENU_SHELL(menubar), file_item);

    // 6. **Размещение панели меню в окне.**
    // Размещаем 'menubar' в верхней части 'vbox'.
    // `FALSE` (expand): не расширять menubar, чтобы он занимал все доступное пространство.
    // `FALSE` (fill): не заполнять доступное пространство, а оставаться в своем минимальном размере.
    // `0` (padding): отступ от других виджетов.
    gtk_box_pack_start(GTK_BOX(vbox), menubar, FALSE, FALSE, 0);

    // 7. **Подключение сигнала к пункту меню "Выход".**
    // Когда пользователь активирует 'exit_item' (например, кликнув на него),
    // будет вызвана функция 'on_menu_item_activate'.
    g_signal_connect(exit_item, "activate", G_CALLBACK(on_menu_item_activate), NULL);

    // 8. **Отображение всех виджетов.**
    // Эта функция рекурсивно делает видимыми 'window' и все его дочерние виджеты.
    gtk_widget_show_all(window);

    // 9. **Запуск главного цикла событий GTK.**
    // Это запускает основной цикл обработки событий, который ожидает действий пользователя
    // (кликов, нажатий клавиш и т.д.) и вызывает соответствующие callback-функции.
    // Приложение будет работать до тех пор, пока не будет вызвана gtk_main_quit().
    gtk_main();

    return 0; // Возвращаем 0, указывая на успешное завершение программы.
}